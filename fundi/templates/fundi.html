{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fundi Page</title>
    <style>
    </style>
</head>
<body>
    <video autoplay playsinline id="client_feed"></video>
    <audio autoplay id="my_audio"></audio>
        <textarea disabled name="" id="some_data" cols="30" rows="10"></textarea>
        <button id="sendDataBtn" disabled="disabled" onclick="sendData()">Send</button>
        
    <input type="hidden" value="{{peer_id}}" id="peer_id">

<script src="{% static 'js/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'js/peerjs.min.js' %}"></script>
<script>
    var peer_id=$('#peer_id').val()
    var connection=null
    const peer = new Peer(peer_id, {
      host: 'localhost',
      port: 9000,
      path: '/'
    });



    peer.on('connection', function(conn) {
        conn.on("open", function (){
            document.getElementById("sendDataBtn").disabled=false
            document.getElementById("some_data").disabled=false
            connection=conn
            conn.on('data', function(data){
                $('#some_data').val($('#some_data').val()+data)
            });
        })
    });
    function sendData(){
        connection.send($('#some_data').val());
    }
   
    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
    peer.on('call', function(call) {
        getUserMedia({video: false, audio: true}, function(stream) {
            // document.getElementById("my_audio").srcObject=stream
            call.answer(stream); // Answer the call with an A/V stream.
            call.on('stream', function(remoteStream) {
                document.getElementById("client_feed").srcObject=remoteStream
            });
        }, function(err) {
            console.log('Failed to get local stream' ,err);
        });
    });




</script>
</body>
</html>